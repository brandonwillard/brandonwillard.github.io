<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Readable Strings and Relational Programming in Hy - Brandon T. Willard</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://brandonwillard.github.io/readable-strings-and-relational-programming-in-hy.html">

        <meta name="author" content="Brandon T. Willard" />
        <meta name="keywords" content="hy,relational programming,python" />

        <meta property="og:site_name" content="Brandon T. Willard" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Readable Strings and Relational Programming in Hy"/>
        <meta property="og:url" content="https://brandonwillard.github.io/readable-strings-and-relational-programming-in-hy.html"/>
        <meta property="og:description" content=""/>
        <meta property="article:published_time" content="2018-12-20" />
            <meta property="article:section" content="articles" />
            <meta property="article:tag" content="hy" />
            <meta property="article:tag" content="relational programming" />
            <meta property="article:tag" content="python" />
            <meta property="article:author" content="Brandon T. Willard" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://brandonwillard.github.io/theme/css/bootstrap.readable.min.css" type="text/css"/>
    <link href="https://brandonwillard.github.io/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://brandonwillard.github.io/theme/css/academicons.min.css" rel="stylesheet">

    <link href="https://brandonwillard.github.io/theme/css/pygments/vim.css" rel="stylesheet">
    <link rel="stylesheet" href="https://brandonwillard.github.io/theme/css/style.css" type="text/css"/>
        <link href="https://brandonwillard.github.io/extra/custom.css" rel="stylesheet">

        <link href="https://brandonwillard.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Brandon T. Willard ATOM Feed"/>

        <link href="https://brandonwillard.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Brandon T. Willard RSS Feed"/>


        <link href="https://brandonwillard.github.io/feeds/articles.atom.xml" type="application/atom+xml" rel="alternate"
              title="Brandon T. Willard articles ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://brandonwillard.github.io/" class="navbar-brand">
Brandon T. Willard            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://brandonwillard.github.io/pages/about.html">
                             About
                          </a></li>
                         <li><a href="https://brandonwillard.github.io/pages/projects.html">
                             Projects
                          </a></li>
                         <li><a href="https://brandonwillard.github.io/pages/publications.html">
                             Publications
                          </a></li>
                        <li class="active">
                            <a href="https://brandonwillard.github.io/category/articles.html">Articles</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://brandonwillard.github.io/readable-strings-and-relational-programming-in-hy.html"
                       rel="bookmark"
                       title="Permalink to Readable Strings and Relational Programming in Hy">
                        Readable Strings and Relational Programming in Hy
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-12-20T00:00:00-06:00"> Thu 20 December 2018</time>
    </span>
          <span class="label label-default">Modified</span>
            <span class="modified">
                <i class="fa fa-calendar"></i><time datetime="2019-01-07T00:00:00-06:00"> Mon 07 January 2019</time>
            </span>





<span class="label label-default">Tags</span>
	<a href="https://brandonwillard.github.io/tag/hy.html">hy</a>
        /
	<a href="https://brandonwillard.github.io/tag/relational-programming.html">relational programming</a>
        /
	<a href="https://brandonwillard.github.io/tag/python.html">python</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Brandon T. Willard" />
  <title>Readable Strings and Relational Programming in Hy</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
</head>
<body>
<!--  -->
<!-- <div id="header"> -->
<!-- <h1 class="title">Readable Strings and Relational Programming in Hy</h1> -->
<!--  -->
<!--  -->
<!-- <h2 class="author">Brandon T. Willard</h2> -->
<!--  -->
<!--  -->
<!-- <h3 class="date">2018–12–20</h3> -->
<!--  -->
<!-- </div> -->
<!--  -->
<div class="abstract">
<p>Just some thoughts on a generalized <code>repr</code> for Hy and some connections with relational programming.</p>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In the past few months, I’ve been working on <a href="https://github.com/hylang/hy">Hy</a> a lot. It’s been great for translating symbolic computation ideas originating in the Lisp community or simply performing the generic meta-programming inherent to the subject.</p>
<p>One feature I’ve been missing the most is “readable” print-outs from the REPL. In this case, “readable” means “a string that can be <code>eval</code>’ed to [re-]produce the object it’s meant to represent”. <a href="https://docs.python.org/3/library/functions.html#repr">Python calls the function(s) that produce these strings “<code>repr</code>”s</a> and provides a generic <code>repr</code> function–with limited Python “readability” guarantees–and a <code>__repr__</code> property for object/class-level customization.</p>
<div class="example" data-markdown="">
<div class="sourceCode" id="org1fcc4d3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="org1fcc4d3-1" title="1">test_obj <span class="op">=</span> {<span class="st">&quot;a&quot;</span>: <span class="dv">1</span>, <span class="st">&quot;b&quot;</span>: [<span class="dv">2</span>, <span class="dv">3</span>]}</a>
<a class="sourceLine" id="org1fcc4d3-2" title="2"></a>
<a class="sourceLine" id="org1fcc4d3-3" title="3"><span class="co"># Produce a readable string using `repr`</span></a>
<a class="sourceLine" id="org1fcc4d3-4" title="4">obj_repr_str <span class="op">=</span> <span class="bu">repr</span>(test_obj)</a>
<a class="sourceLine" id="org1fcc4d3-5" title="5"><span class="bu">print</span>(obj_repr_str)</a>
<a class="sourceLine" id="org1fcc4d3-6" title="6"></a>
<a class="sourceLine" id="org1fcc4d3-7" title="7"><span class="co"># Re-create the object from its readable string form</span></a>
<a class="sourceLine" id="org1fcc4d3-8" title="8">obj_from_repr <span class="op">=</span> <span class="bu">eval</span>(obj_repr_str)</a>
<a class="sourceLine" id="org1fcc4d3-9" title="9"><span class="bu">print</span>(obj_from_repr)</a>
<a class="sourceLine" id="org1fcc4d3-10" title="10"></a>
<a class="sourceLine" id="org1fcc4d3-11" title="11"><span class="bu">print</span>(test_obj <span class="op">==</span> obj_from_repr)</a></code></pre></div>
<div class="sourceCode" id="orgd8b6ebf"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="orgd8b6ebf-1" title="1">{<span class="st">&#39;a&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;b&#39;</span>: [<span class="dv">2</span>, <span class="dv">3</span>]}</a>
<a class="sourceLine" id="orgd8b6ebf-2" title="2">{<span class="st">&#39;a&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;b&#39;</span>: [<span class="dv">2</span>, <span class="dv">3</span>]}</a>
<a class="sourceLine" id="orgd8b6ebf-3" title="3"><span class="va">True</span></a>
<a class="sourceLine" id="orgd8b6ebf-4" title="4"></a></code></pre></div>
</div>
<p>There’s already a <code>hy.contrib.hy-repr</code> module that gets most of the way there, but it doesn’t implement the Python standard library’s <code>reprlib.Repr</code>. The class <code>reprlib.Repr</code> implements limits for the display lengths of the strings it produces, and its source code provides a few standard library implementations of primitive object <code>repr</code>s–which require only trivial changes to produce the desired Hy syntax.</p>
<p>For these reasons–and an overall interest in using and translating more of the Python standard library to Hy–I decided to try a quick refactoring of <code>hy.contrib.hy-repr</code> that implements <code>reprlib.Repr</code>.</p>
</section>
<section id="the-hy-repr-problems" class="level1">
<h1>The Hy <code>repr</code> Problem(s)</h1>
<p>The translation of Hy AST to string form is fairly straight-forward. In most cases, one only needs to change the <code>repr</code>s for Python primitives and basic function calls (e.g. from <code>func(1)</code> to <code>(func 1)</code>); however, changing just a couple lines in <code>repr</code>/<code>__repr__</code> functions for all the Python builtins is very annoying.</p>
<p>Furthermore, what about those custom object <code>__repr__</code> methods? While one might be able to manually patch most–if not all–of the (Python-implemented) standard library objects, there are far too many 3rd-party library <code>__repr__</code>s with exactly the same trivial function-call form that can’t reasonably be patched.</p>
<section id="some-approaches" class="level2">
<h2>Some approaches</h2>
<p>The first few things that come to mind when considering a more general approach to Python-to-Hy <code>__repr__</code> translation involve some use of the existing <code>repr</code> code. That might come in the form of string manipulation of <code>repr</code> output, which <code>hy.contrib.hy-repr</code> already does in some cases, or quite possibly some use of a <code>repr</code> function’s source or code object.</p>
<p>The latter seems like it has the potential to be more thorough and far-reaching, but also considerably more involved and computationally inefficient. Unfortunately, similar things can be said about the regex approach. Although it does seem a little easier to implement and–for limited cases–efficient enough for most purposes, it also comes across as much more brittle.</p>
<p>Fortunately, the latter is unnecessary, because, when the existing <code>repr</code> output is Python readable, it can be parsed by <code>ast.parse</code>. The function <code>ast.parse</code> effectively handles the regex work and yields the bulk of information needed for a Hy <code>repr</code> string: the function name and its (positional and keyword) arguments.</p>
<div class="example" data-markdown="">
<p>Let’s say we implement our own object and <code>repr</code>.</p>
<pre id="orgcb48770" class="hy"><code>(defclass TestClass [object]
  (defn --init-- [self arg1 arg2 &amp;optional kwarg1 kwarg2]
    (setv self.arg1 arg1
          self.arg2 arg2
          self.kwarg1 kwarg1
          self.kwarg2 kwarg2))
  (defn --repr-- [self]
    (.format &quot;TestClass({}, {}, kwarg1={}, kwarg2={})&quot;
             #* (lfor a [self.arg1 self.arg2
                         self.kwarg1 self.kwarg2]
                      (repr a)))))

(setv test-obj (TestClass 1 {&quot;a&quot; 1 &quot;b&quot; 2} :kwarg1 1 :kwarg2 &quot;ok&quot;))
(print (repr test-obj))</code></pre>
<div class="sourceCode" id="org400ef0c"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="org400ef0c-1" title="1">TestClass(<span class="dv">1</span>, {<span class="st">&#39;a&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;b&#39;</span>: <span class="dv">2</span>}, kwarg1<span class="op">=</span><span class="dv">1</span>, kwarg2<span class="op">=</span><span class="st">&#39;ok&#39;</span>)</a></code></pre></div>
<p>Since the results are readable, we can do the following:</p>
<pre id="org382ba33" class="hy"><code>(import ast astor)
(setv repr-ast (ast.parse (repr test-obj) :mode &quot;eval&quot;))
(print (astor.dump repr-ast))</code></pre>
<div class="sourceCode" id="org918f48e"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="org918f48e-1" title="1">Expression(</a>
<a class="sourceLine" id="org918f48e-2" title="2">    body<span class="op">=</span>Call(func<span class="op">=</span>Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;TestClass&#39;</span>),</a>
<a class="sourceLine" id="org918f48e-3" title="3">              args<span class="op">=</span>[Num(n<span class="op">=</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="org918f48e-4" title="4">                    Dict(keys<span class="op">=</span>[Str(s<span class="op">=</span><span class="st">&#39;a&#39;</span>), Str(s<span class="op">=</span><span class="st">&#39;b&#39;</span>)],</a>
<a class="sourceLine" id="org918f48e-5" title="5">                         values<span class="op">=</span>[Num(n<span class="op">=</span><span class="dv">1</span>), Num(n<span class="op">=</span><span class="dv">2</span>)])],</a>
<a class="sourceLine" id="org918f48e-6" title="6">              keywords<span class="op">=</span>[keyword(arg<span class="op">=</span><span class="st">&#39;kwarg1&#39;</span>, value<span class="op">=</span>Num(n<span class="op">=</span><span class="dv">1</span>)),</a>
<a class="sourceLine" id="org918f48e-7" title="7">                        keyword(arg<span class="op">=</span><span class="st">&#39;kwarg2&#39;</span>, value<span class="op">=</span>Str(s<span class="op">=</span><span class="st">&#39;ok&#39;</span>))]))</a></code></pre></div>
</div>
</section>
<section id="a-generalized-hy-repr-prototype" class="level2">
<h2>A Generalized Hy <code>repr</code> Prototype</h2>
<p>With existing <code>repr</code> output converted to Python AST by Python itself (using <code>ast.parse</code>), we can produce readable Hy strings from the resulting AST objects.</p>
<p>In this scenario, we need only be concerned with the conversion of Python AST into readable Hy strings. This works like an inverse to the Hy compiler: in other words, a Hy decompiler. For <code>repr</code> purposes, only function call statements and their arguments need to be decompiled. Unfortunately, function arguments can consist of arbitrary Python/Hy objects, and that’s how the decompilation responsibilities start to expand. If we limit our scope to a reasonable subset of Python builtins/primitives, the results can still be quite effective, and won’t require a complete decompiler.</p>
<p>On the down-side, if a Hy <code>repr</code> implementation overrides the built-in <code>repr</code>, then arguments in existing <code>repr</code>/<code>__repr__</code>s might already be converted by the overridden <code>repr</code>; however, the results from <code>ast.parse</code> will undo/discard those results. Even so, custom class <code>__repr__</code>s aren’t guaranteed to use the built-in <code>repr</code> on their arguments, so attempts to salvage already-converted <code>repr</code> output are undeniably fraught with complications.</p>
<div class="example" data-markdown="">
<p>Working from the <code>repr</code>-produced AST above, I mocked-up a quick prototype for a generic Python-to-Hy conversion function.</p>
<pre id="orga431a0a" class="hy"><code>(import ast)
(import builtins)

(import [hy.contrib.hy-repr [hy-repr :as -hy-repr]])

(defn ast-funcall-to-hy [ast-obj repr1
                         &amp;optional [level 1]]
  &quot;Turn Python `ast.Call` expressions into Hy `repr` strings.

XXX: Only a very minimal subset of Python-to-Hy AST is implemented.

This can be used to turn a \&quot;readable\&quot; `repr` result, via an actual \&quot;read\&quot; by
`ast.parse`, to Python AST then Hy AST.
&quot;
  (assert (and (instance? ast.Expression ast-obj)
               (instance? ast.Call ast-obj.body)))
  (setv func-name (. ast-obj body func id))
  (setv eval-fn (fn [o]
                  (if (instance? ast.Name o)
                      o.id
                      (repr1 (ast.literal-eval o) (dec level)))))
  (setv func-args (lfor a (. ast-obj body args) (eval-fn a)))
  (setv func-kwargs (lfor k (. ast-obj body keywords)
                          (.format &quot;:{} {}&quot; k.arg (eval-fn k.value))))
  (.format &quot;({})&quot; (.join &quot; &quot; (+ [func-name] func-args func-kwargs))))


(setv test-ast (ast.parse &quot;range(x, y, blah=1, bloh=\&quot;ok\&quot;)&quot; :mode &quot;eval&quot;))
(print (ast-funcall-to-hy test-ast (fn [x &amp;rest y] (-hy-repr x))))</code></pre>
<pre id="orga24c441" class="hy"><code>(range x y :blah 1 :bloh &quot;ok&quot;)</code></pre>
<p><code>ast-funcall-to-hy</code> is an extremely narrow decompiler that only handles readable function calls (represented by <code>ast.Call</code> nodes), but, as part of a fallback sequence in a Hy <code>repr</code> implementation, it’s still pretty useful.</p>
<p>A function like <code>ast-funcall-to-hy</code> can be used in <code>repr</code> logic as follows:</p>
<pre id="org80332ca" class="hy"><code>(defn hy-repr [x &amp;optional [level 1] [-repr (fn [x &amp;rest y] (-hy-repr x))]]
  &quot;Use `builtin.repr` results to generate readable Hy `repr` strings for cases
we haven&#39;t covered explicitly.
&quot;
  (try
    (setv s (builtins.repr x))
    (when (not (.startswith s &quot;&lt;&quot;))
      (do
        (setv repr-ast (ast.parse s :mode &quot;eval&quot;))
        (setv s (ast-funcall-to-hy repr-ast -repr))))
    s
    (except [Exception]
      (.format &quot;&lt;{} instance at {}&gt;&quot; x.__class__.__name__ (id x)))))</code></pre>
<p>Now, for the example class, <code>TestClass</code>, we can demonstrate automatic conversion of its Python <code>__repr__</code> implementation.</p>
<pre id="org21d5bb7" class="hy"><code>(setv test-ast (TestClass 1 {&quot;a&quot; 2 &quot;b&quot; 3} :kwarg1 1 :kwarg2 &quot;ok&quot;))
(print (.format &quot;before: {}\nafter: {}&quot;
                (repr test-ast)
                (hy-repr test-ast)))</code></pre>
<pre id="orgfc788b4" class="text"><code>before: TestClass(1, {&#39;a&#39;: 2, &#39;b&#39;: 3}, kwarg1=1, kwarg2=&#39;ok&#39;)
after: (TestClass 1 {&quot;a&quot; 2  &quot;b&quot; 3} :kwarg1 1 :kwarg2 &quot;ok&quot;)</code></pre>
</div>
</section>
</section>
<section id="relational-programming" class="level1">
<h1>Relational Programming</h1>
<p>While considering all this, I kept thinking about how nice it would be to have a “bijective” compiler; in other words, the existing Hy compiler, which translates Hy-to-Python, <strong>and</strong> a Python-to-Hy (de)compiler. With a Python-to-Hy AST compiler, we could more broadly convert Python AST output–like the kind in our example above–to a <code>repr</code>/readable string in Hy.</p>
<p>The idea isn’t too crazy, especially since one can easily work backward from a lot of the logic in the existing Hy compiler. There will be some edge cases that result in non-bijective translations (i.e. some round-trip Hy/Python translations might only be <strong>equal</strong> and not exactly <strong>equivalent</strong>), but this isn’t necessarily a blocking issue. Decisions regarding “canonical” or reduced forms of Hy/Python AST might be necessary, especially if the resulting AST is intended to be more human readable than not.</p>
<p>Perhaps what’s more discouraging is the effort it would take to ensure that the compilation processes going both ways are–and stay–coherent during the course of development. For instance, when changes are made to the standard compilation process (i.e. Hy-to-Python), it’s likely that changes and tests would also be needed for the other direction.</p>
<p>This is where a paradigm like relational programming is particularly appealing: it provides a language for defining–and means for computing–the maps</p>
<p><span class="math display">\[\begin{equation*}
  \text{Hy Syntax}
  \longleftrightarrow \text{Python AST}
  \longleftrightarrow \text{Python Syntax}
  \;
\end{equation*}\]</span></p>
<p>in a cohesive way.</p>
<p>My relational programming DSL of choice, <a href="http://minikanren.org">miniKanren</a>, already has an implementation in Hy: <a href="https://github.com/algernon/adderall"><code>loghyc</code> (and to be formally known as <code>adderall</code>)</a>. We’ve been using it to perform static code analysis and refactoring in the project <a href="https://github.com/hylang/hydiomatic"><code>hydiomatic</code></a>, so there’s also a precedent for parsing Hy syntax in a relational context.</p>
<p>The missing/next step would be to output Python AST (instead of more Hy forms, like <code>hydiomatic</code> produces, for example). In the following sections, we will construct a small relational Hy/Python compiler as a proof-of-concept.</p>
<section id="a-prototype-relational-compiler" class="level2">
<h2>A Prototype Relational Compiler</h2>
<p>Creating a bi-directional Hy/Python AST compiler in miniKanren involves the construction of goals “relating” the two AST forms. For simplicity, we’ll just consider function call expressions, like <code>func(args)</code> and <code>(func args)</code>.</p>
<p>Also, since these kinds of relations are more easy to specify using constraints, we’ll use a prototype microKanren implementation in Hy that provides them: <a href="https://github.com/brandonwillard/hypoKanren"><code>hypoKanren</code></a>.</p>
<p>First, let’s examine the general structure of the AST objects for each form.</p>
<pre id="org322b444" class="hy"><code>(astor.dump (hy-compile `(if x y z) &quot;__console__&quot;))</code></pre>
<div class="sourceCode" id="orgd2dbcdd"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="orgd2dbcdd-1" title="1">Module(body<span class="op">=</span>[Expr(value<span class="op">=</span>IfExp(test<span class="op">=</span>Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;x&#39;</span>), body<span class="op">=</span>Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;y&#39;</span>), orelse<span class="op">=</span>Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;z&#39;</span>)))])</a></code></pre></div>
<pre id="org7521929" class="hy"><code>(astor.dump (hy-compile `(func x :y z) &quot;__console__&quot;))</code></pre>
<div class="sourceCode" id="orgdc5ccf2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="orgdc5ccf2-1" title="1">Module(</a>
<a class="sourceLine" id="orgdc5ccf2-2" title="2">    body<span class="op">=</span>[Expr(value<span class="op">=</span>Call(func<span class="op">=</span>Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;func&#39;</span>), args<span class="op">=</span>[Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;x&#39;</span>)], keywords<span class="op">=</span>[keyword(arg<span class="op">=</span><span class="st">&#39;y&#39;</span>, value<span class="op">=</span>Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;z&#39;</span>))]))])</a></code></pre></div>
<section id="ast-object-unification" class="level3">
<h3>AST Object Unification</h3>
<p>To make existing Python AST objects amenable to the <a href="https://en.wikipedia.org/wiki/Unification_(computer_science)">unification</a> used by miniKanren, we implement <code>unify</code> specializations for <code>ast.AST</code> types. Our implementation simply generates unevaluated Hy forms, or Hy AST, that–when evaluated–would (re)create the <code>ast.AST</code> objects.</p>
<div class="REMARK">
<p>Alternatively, we could only ever use and create unevaluated Hy forms for Python AST. Providing unification for AST objects allows for more immediate integration with existing Python code and/or what it would most likely produce.</p>
</div>
<p><code>hypoKanren</code> uses <a href="https://github.com/mrocklin/multipledispatch"><code>multipledispatch</code></a>, so augmenting the unification process is easy. This is how we’ll add support for AST objects.</p>
<div class="REMARK">
<p>There’s already a good pure Python library for unification built upon <code>multipledispatch</code>, <a href="https://github.com/mrocklin/unification"><code>unfication</code></a>. At a later time, it might be worthwhile to simply add support for Hy objects and use that library instead.</p>
</div>
<pre id="org1468291" class="hy"><code>(import [multipledispatch [dispatch]])
(import [hypoKanren.unify [*]])
(import [hy.models [*]])
(import [hy.contrib.walk [prewalk]])


(defmacro/g! dispatch-unify-trans [disp-type trans-func &amp;optional [func &#39;unify]]
  `(do
     #@((dispatch ~disp-type object object)
        (defn unify-post-walk [~g!u ~g!v ~g!s]
          (~func (~trans-func ~g!u) ~g!v ~g!s)))
     #@((dispatch object ~disp-type object)
        (defn unify-post-walk [~g!u ~g!v ~g!s]
          (~func ~g!u (~trans-func ~g!v) ~g!s)))
     #@((dispatch ~disp-type ~disp-type object)
        (defn unify-post-walk [~g!u ~g!v ~g!s]
          (~func (~trans-func ~g!u) (~trans-func ~g!v) ~g!s)))))

(defn py-ast-to-expr [x]
  (defn -py-ast-to-expr [u]
    (setv ast-expr
          `(~(HySymbol (+ &quot;ast.&quot; (name (type u))))
            ~@(chain.from-iterable
                (lfor f u.-fields
                      :if (hasattr u f)
                      [(HyKeyword f) (getattr u f)]))))
    ast-expr)
  (prewalk (fn [y] (if (instance? ast.AST y)
                       (-py-ast-to-expr y)
                       y))
           x))

;; Python AST expansion pre-unification
(dispatch-unify-trans ast.AST (fn [x] (py-ast-to-expr x)))</code></pre>
<div class="example" data-markdown="">
<pre id="org70c1279" class="hy"><code>;; One is an `ast.AST` object, the other an unevaluated `ast.AST`
;; object-generating form.
(setv unify-exa-1 (unify (ast.Expr :value [])
                         `(ast.Expr :value ~(var 0))
                         {}))

;; Both are `ast.AST` objects
(setv unify-exa-2 (unify (ast.Expr :value [])
                         (ast.Expr :value (var 0))
                         {}))

(= (.get unify-exa-1 (var 0))
   (.get unify-exa-2 (var 0))
   [])</code></pre>
<div class="sourceCode" id="org043df5d"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="org043df5d-1" title="1"><span class="va">True</span></a></code></pre></div>
<p>Listing <a href="#org70c1279">17</a> illustrates unification of two <code>ast.AST</code> forms. The <code>(var 0)</code> objects are “logic variables” taking the value of sub-expressions that cause the two <code>unify</code> arguments to, well, unify. The third argument to <code>unify</code> is simply a <code>dict</code> that stores the logic variable/sub-expression mappings.</p>
<p>In other words, logic variables are like unknowns that <code>unify(u, v, s)</code> will “solve” in order to make <code>u</code> and <code>v</code> equal.</p>
</div>
<div class="example" data-markdown="">
<pre id="orgd9478e0" class="hy"><code>(unify (cons &#39;ast.Expr (var 0))
       (ast.Expr :value [(ast.Name :id &quot;a&quot;)])
       {})</code></pre>
<div class="sourceCode" id="org05aa032"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="org05aa032-1" title="1">{(LVar <span class="dv">0</span>): HyExpression([</a>
<a class="sourceLine" id="org05aa032-2" title="2">  HyKeyword(<span class="st">&#39;value&#39;</span>),</a>
<a class="sourceLine" id="org05aa032-3" title="3">  [HyExpression([</a>
<a class="sourceLine" id="org05aa032-4" title="4">    HySymbol(<span class="st">&#39;ast.Name&#39;</span>),</a>
<a class="sourceLine" id="org05aa032-5" title="5">    HyKeyword(<span class="st">&#39;id&#39;</span>),</a>
<a class="sourceLine" id="org05aa032-6" title="6">    <span class="st">&#39;a&#39;</span>])]])}</a></code></pre></div>
<p>Listing <a href="#orgd9478e0">19</a> is a more interesting example that demonstrates partial/improper list unification. Since <code>ast.AST</code> objects are expanded into equal object-instantiating Hy AST forms, <code>(cons 'ast.Expr (var 0))</code> is ultimately unified with a <code>HyExpression</code> (a subclass of <code>list</code>). Under the <code>cons</code> abstraction, <code>(var 0)</code> can be anything that–when <code>cons</code>ed with the symbol <code>ast.Expr</code>–will produce the expression <code>(ast.Expr :value [(ast.Name :id "a")])</code>. The result is the partial <code>HyExpression</code> comprising the arguments to the <code>ast.Expr</code> constructor–in other words, the <code>cdr</code> of the <code>ast.AST</code> form.</p>
</div>
<p>We will also need to unify some limited Hy AST forms; specifically, <code>HySymbol</code>s. We will want to extract only the name part of a Hy symbol and relate that to Python <code>ast.Name</code>s via one of the latter’s constructor arguments.</p>
<p>Similar to Python AST nodes, we will expand/lift/abstract <code>HySymbol</code>s to Hy expressions that–when <code>eval</code>’ed–would construct them. We can only do this in very limited cases; otherwise, we could end up producing ever-expanding forms.</p>
<pre id="org7b1a1a0" class="hy"><code>;; Hy AST expansion pre-unification
(defn unify-hysymbol [u v s]
  (cond
    [(= (first v) &#39;HySymbol)
     (print )
     (unify `(HySymbol ~(name u)) v s)]
    [True
     (unify u v s)]))

#@((dispatch HySymbol HyExpression object)
   (defn unify-post-walk [u v s]
     (unify-hysymbol u v s)))

#@((dispatch HyExpression HySymbol object)
   (defn unify-post-walk [u v s]
     (unify-hysymbol v u s)))</code></pre>
<div class="example" data-markdown="">
<pre id="orgbc4dbe9" class="hy"><code>(unify &#39;a `(HySymbol ~(var 0)) {})</code></pre>
<div class="sourceCode" id="orgc000745"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="orgc000745-1" title="1">{(LVar <span class="dv">0</span>): <span class="st">&#39;a&#39;</span>}</a></code></pre></div>
<p>Listing <a href="#org7b1a1a0">21</a> demonstrates the expansion and unification of Hy AST symbols.</p>
</div>
</section>
<section id="call-expression-goals" class="level3">
<h3>Call-expression Goals</h3>
<p>Next, we create the miniKanren goals that encapsulate the relationships between simple Hy and Python AST forms. In particular, we’ll limit ourselves to only variable reference and function call forms.</p>
<pre id="orge442cd6" class="hy"><code>(defn listo [l]
  &quot;A goal stating that `l` is a list.&quot;
  (conde
    [(== l []) s#]
    [(fresh [lcar lcdr]
            (== l (cons lcar lcdr))
            (listo lcdr))]
    [s# u#]))</code></pre>
<p>The first AST relation is a simple one between <code>HySymbol</code>s and <code>ast.Name</code>s. This is where the <code>HySymbol</code> unification implemented above is used.</p>
<pre id="org9fe6aea" class="hy"><code>(defn hy-py-symbolo [hy-ast py-ast]
  &quot;A goal relating Hy and Python AST symbol/name objects (e.g. variable and
 function references).&quot;
  (fresh [symbol-name py-ctx]
         (== hy-ast `(HySymbol ~symbol-name))
         (== py-ast `(ast.Name :id ~symbol-name
                               :ctx (ast.Load)))))</code></pre>
<p>Some Python <code>ast.AST</code> types have fields consisting of lists containing other <code>ast.AST</code> objects (e.g. the <code>ast.Call</code> expressions below). We need a goal that enforces a relation between the Hy and Python AST forms of each element in such lists.</p>
<pre id="org988ece9" class="hy"><code>(defn lapplyo [func l-in l-out]
  &quot;A goal that applies the goal `func` between all elements in lists `l-in` and
 `l-out`.&quot;
  (conj+
    (listo l-in)
    (conde
      [(fresh [lcar lcdr lout-car lout-cdr]
              (== l-in (cons lcar lcdr))
              (hy-py-symbolo lcar lout-car)
              (lapplyo func lcdr lout-cdr)
              (== l-out (cons lout-car lout-cdr)))]
      [(== l-in [])
       (== l-out l-in)])))</code></pre>
<p>Finally, we create a goal for the AST of call expressions like <code>func(x, y, z)</code> and <code>(func x y z)</code>.</p>
<pre id="org10bec84" class="hy"><code>(defn hy-py-callo [hy-ast py-ast]
  &quot;A goal relating call expressions in Python and Hy AST.&quot;
  (fresh [hy-op hy-args py-op py-args]
         ;; Hy AST form
         (== (cons hy-op hy-args) hy-ast)
         ;; Py AST form
         (== py-ast `(ast.Expr :value
                               (ast.Call :func
                                         ~py-op
                                         :args
                                         ~py-args
                                         :keywords
                                         [])))
         ;; These two must be related symbols
         (hy-py-symbolo hy-op py-op)
         ;; The arguments are related lists containing more of each AST type.
         (lapplyo hy-py-asto hy-args py-args)))

(defn hy-py-asto [hy-ast py-ast]
  &quot;A goal for a &#39;branching&#39; relation between multiple types of forms and their
 corresponding Python AST.&quot;
  (conde
    [(hy-py-symbolo hy-ast py-ast)]
    [(hy-py-callo hy-ast py-ast)]))</code></pre>
<div class="example" data-markdown="">
<p>To demonstrate our [extremely] minimal relational compiler, we create a Hy function call expression and its corresponding Python AST.</p>
<pre id="org7845670" class="hy"><code>(setv hy-ast-exa `(print x y z))
(setv py-ast-exa (. (hy-compile hy-ast-exa &quot;__console__&quot;) body [0]))
(.format &quot;hy_ast_exa = {}\npy_ast_exa = {}&quot;
         hy-ast-exa
         (astor.dump py-ast-exa))</code></pre>
<div class="sourceCode" id="org06b2621"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="org06b2621-1" title="1">hy_ast_exa <span class="op">=</span> HyExpression([</a>
<a class="sourceLine" id="org06b2621-2" title="2">  HySymbol(<span class="st">&#39;print&#39;</span>),</a>
<a class="sourceLine" id="org06b2621-3" title="3">  HySymbol(<span class="st">&#39;x&#39;</span>),</a>
<a class="sourceLine" id="org06b2621-4" title="4">  HySymbol(<span class="st">&#39;y&#39;</span>),</a>
<a class="sourceLine" id="org06b2621-5" title="5">  HySymbol(<span class="st">&#39;z&#39;</span>)])</a>
<a class="sourceLine" id="org06b2621-6" title="6">py_ast_exa <span class="op">=</span> Expr(value<span class="op">=</span>Call(func<span class="op">=</span>Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;print&#39;</span>), args<span class="op">=</span>[Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;x&#39;</span>), Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;y&#39;</span>), Name(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;z&#39;</span>)], keywords<span class="op">=</span>[]))</a></code></pre></div>
<p>We first run the Hy-to-Python direction by providing <code>hy-expro</code> the <code>hy-ast-exa</code> value above and a logic variable (i.e. an “unknown”) for the Python AST term.</p>
<pre id="org5336211" class="hy"><code>(setv rel-res (run 1 [py-ast] (hy-py-asto hy-ast-exa py-ast)))
(setv ast-res (get rel-res 0 0))
ast-res</code></pre>
<div class="sourceCode" id="org5ab617c"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="org5ab617c-1" title="1">HyExpression([</a>
<a class="sourceLine" id="org5ab617c-2" title="2">  HySymbol(<span class="st">&#39;ast.Expr&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-3" title="3">  HyKeyword(<span class="st">&#39;value&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-4" title="4">  HyExpression([</a>
<a class="sourceLine" id="org5ab617c-5" title="5">    HySymbol(<span class="st">&#39;ast.Call&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-6" title="6">    HyKeyword(<span class="st">&#39;func&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-7" title="7">    HyExpression([</a>
<a class="sourceLine" id="org5ab617c-8" title="8">      HySymbol(<span class="st">&#39;ast.Name&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-9" title="9">      HyKeyword(<span class="st">&#39;id&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-10" title="10">      <span class="st">&#39;print&#39;</span>,</a>
<a class="sourceLine" id="org5ab617c-11" title="11">      HyKeyword(<span class="st">&#39;ctx&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-12" title="12">      HyExpression([</a>
<a class="sourceLine" id="org5ab617c-13" title="13">        HySymbol(<span class="st">&#39;ast.Load&#39;</span>)])]),</a>
<a class="sourceLine" id="org5ab617c-14" title="14">    HyKeyword(<span class="st">&#39;args&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-15" title="15">    HyExpression([</a>
<a class="sourceLine" id="org5ab617c-16" title="16">      HyExpression([</a>
<a class="sourceLine" id="org5ab617c-17" title="17">        HySymbol(<span class="st">&#39;ast.Name&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-18" title="18">        HyKeyword(<span class="st">&#39;id&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-19" title="19">        <span class="st">&#39;x&#39;</span>,</a>
<a class="sourceLine" id="org5ab617c-20" title="20">        HyKeyword(<span class="st">&#39;ctx&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-21" title="21">        HyExpression([</a>
<a class="sourceLine" id="org5ab617c-22" title="22">          HySymbol(<span class="st">&#39;ast.Load&#39;</span>)])]),</a>
<a class="sourceLine" id="org5ab617c-23" title="23">      HyExpression([</a>
<a class="sourceLine" id="org5ab617c-24" title="24">        HySymbol(<span class="st">&#39;ast.Name&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-25" title="25">        HyKeyword(<span class="st">&#39;id&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-26" title="26">        <span class="st">&#39;y&#39;</span>,</a>
<a class="sourceLine" id="org5ab617c-27" title="27">        HyKeyword(<span class="st">&#39;ctx&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-28" title="28">        HyExpression([</a>
<a class="sourceLine" id="org5ab617c-29" title="29">          HySymbol(<span class="st">&#39;ast.Load&#39;</span>)])]),</a>
<a class="sourceLine" id="org5ab617c-30" title="30">      HyExpression([</a>
<a class="sourceLine" id="org5ab617c-31" title="31">        HySymbol(<span class="st">&#39;ast.Name&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-32" title="32">        HyKeyword(<span class="st">&#39;id&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-33" title="33">        <span class="st">&#39;z&#39;</span>,</a>
<a class="sourceLine" id="org5ab617c-34" title="34">        HyKeyword(<span class="st">&#39;ctx&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-35" title="35">        HyExpression([</a>
<a class="sourceLine" id="org5ab617c-36" title="36">          HySymbol(<span class="st">&#39;ast.Load&#39;</span>)])])]),</a>
<a class="sourceLine" id="org5ab617c-37" title="37">    HyKeyword(<span class="st">&#39;keywords&#39;</span>),</a>
<a class="sourceLine" id="org5ab617c-38" title="38">    HyList()])])</a></code></pre></div>
<p>And, now, the other direction (i.e. known Python AST, unknown Hy AST).</p>
<pre id="org7148809" class="hy"><code>(setv rel-res (run 1 [hy-ast] (hy-py-asto hy-ast py-ast-exa)))
(setv ast-res (get rel-res 0 0))
ast-res</code></pre>
<div class="sourceCode" id="org5731a00"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="org5731a00-1" title="1">[HyExpression([</a>
<a class="sourceLine" id="org5731a00-2" title="2">  HySymbol(<span class="st">&#39;HySymbol&#39;</span>),</a>
<a class="sourceLine" id="org5731a00-3" title="3">  <span class="st">&#39;print&#39;</span>]), HyExpression([</a>
<a class="sourceLine" id="org5731a00-4" title="4">  HySymbol(<span class="st">&#39;HySymbol&#39;</span>),</a>
<a class="sourceLine" id="org5731a00-5" title="5">  <span class="st">&#39;x&#39;</span>]), HyExpression([</a>
<a class="sourceLine" id="org5731a00-6" title="6">  HySymbol(<span class="st">&#39;HySymbol&#39;</span>),</a>
<a class="sourceLine" id="org5731a00-7" title="7">  <span class="st">&#39;y&#39;</span>]), HyExpression([</a>
<a class="sourceLine" id="org5731a00-8" title="8">  HySymbol(<span class="st">&#39;HySymbol&#39;</span>),</a>
<a class="sourceLine" id="org5731a00-9" title="9">  <span class="st">&#39;z&#39;</span>])]</a></code></pre></div>
</div>
</section>
</section>
</section>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  CommonHTML: { linebreaks: { automatic: true } },
  "HTML-CSS": { linebreaks: { automatic: true } },
  SVG: { linebreaks: { automatic: true } },
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
</body>
</html>

            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'brandonwillard-github-io'; // required: replace example with your forum shortname

                    var disqus_identifier = 'readable-strings-and-relational-programming-in-hy';
                var disqus_url = 'https://brandonwillard.github.io/readable-strings-and-relational-programming-in-hy.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="https://brandonwillard.github.io//images/profile-pic.png"/>
        </p>
    <p>
      <strong>About Brandon T. Willard</strong><br/>
        applied math/stats person
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="https://linkedin.com/pub/brandon-willard/10/bb4/468/"><i class="fa fa-linkedin fa-lg"></i> linkedin</a></li>
    <li class="list-group-item"><a href="https://scholar.google.com/citations?user=g0oUxG4AAAAJ&hl=en"><i class="ai ai-google-scholar ai-lg"></i> google scholar</a></li>
    <li class="list-group-item"><a href="https://plus.google.com/+brandonwillard"><i class="fa fa-google-plus fa-lg"></i> google+</a></li>
    <li class="list-group-item"><a href="https://bitbucket.io/brandonwillard"><i class="fa fa-bitbucket-square fa-lg"></i> bitbucket</a></li>
    <li class="list-group-item"><a href="https://github.com/brandonwillard"><i class="fa fa-github-square fa-lg"></i> github</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Brandon T. Willard
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">Creative Commons Attribution-NonCommercial 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://brandonwillard.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://brandonwillard.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://brandonwillard.github.io/theme/js/respond.min.js"></script>


    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'brandonwillard-github-io'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics Universal -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-91585967-1', '');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics Universal Code -->


</body>
</html>